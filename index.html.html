<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Affirmations ‚ú®</title>

  <!-- Cute fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Pacifico&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#ffd6e7;
      --bg2:#ffeef6;
      --bg3:#f7d6ff;
      --card:#ffffffcc;
      --card2:#fff7fbcc;
      --ink:#4a2a3a;
      --muted:#7a4a62;
      --hot:#ff4fa1;
      --hot2:#ff7bc0;
      --line:#ffb3d6;
      --shadow: 0 18px 45px rgba(255, 79, 161, .18);
      --shadow2: 0 10px 25px rgba(74, 42, 58, .12);
      --radius: 26px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--ink);
      font-family:"Quicksand", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
      background: radial-gradient(1200px 600px at 15% 10%, var(--bg2), transparent 60%),
                  radial-gradient(900px 600px at 85% 20%, var(--bg3), transparent 55%),
                  linear-gradient(140deg, var(--bg1), var(--bg2));
    }

    /* soft grain overlay */
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.12;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode:soft-light;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: clamp(18px, 3vw, 32px);
      position:relative;
    }

    header{
      text-align:center;
      margin-bottom:14px;
      position:relative;
    }

    .logo{
      font-family:"Pacifico", cursive;
      font-size: clamp(30px, 4.2vw, 44px);
      letter-spacing:.4px;
      color: #ff2f97;
      text-shadow: 0 10px 30px rgba(255, 79, 161, .22);
      animation: floaty 3.8s ease-in-out infinite;
      user-select:none;
    }

    @keyframes floaty{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-6px); }
    }

    .subtitle{
      margin:8px 0 0;
      color:var(--muted);
      font-weight:600;
      opacity:.95;
    }

    .app{
      width: min(980px, 100%);
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 18px;
      align-items:start;
    }

    @media (max-width: 880px){
      .app{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid rgba(255, 179, 214, .75);
      border-radius: var(--radius);
      box-shadow: var(--shadow), var(--shadow2);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 18px;
      position:relative;
      overflow:hidden;
      transform: translateY(10px);
      opacity: 0;
      animation: popIn .8s cubic-bezier(.2,.9,.2,1) forwards;
    }

    @keyframes popIn{
      to{ transform: translateY(0); opacity: 1; }
    }

    .card::after{
      content:"";
      position:absolute;
      inset:-60px -60px auto auto;
      width: 190px;
      height: 190px;
      background: radial-gradient(circle at 30% 30%, rgba(255, 79, 161, .24), transparent 62%);
      transform: rotate(25deg);
      pointer-events:none;
    }

    .nowRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom: 12px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 179, 214, .9);
      background: rgba(255, 255, 255, .72);
      box-shadow: 0 8px 18px rgba(255, 79, 161, .12);
      color: var(--muted);
      font-weight:700;
      font-size: 13px;
      user-select:none;
    }

    .dot{
      width:10px; height:10px;
      border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, var(--hot));
      box-shadow: 0 0 0 5px rgba(255,79,161,.14);
      animation: pulse 1.8s ease-in-out infinite;
    }

    @keyframes pulse{
      0%,100%{ transform: scale(1); opacity: .95; }
      50%{ transform: scale(1.15); opacity: .75; }
    }

    .toggles{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .toggle{
      cursor:pointer;
      border:none;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(255, 179, 214, .9);
      border-radius: 999px;
      padding: 8px 12px;
      font-weight:700;
      color: var(--muted);
      box-shadow: 0 8px 18px rgba(255, 79, 161, .10);
      transition: transform .15s ease, box-shadow .15s ease, background .2s ease;
      user-select:none;
    }
    .toggle:hover{ transform: translateY(-1px); box-shadow: 0 12px 24px rgba(255, 79, 161, .14); }
    .toggle:active{ transform: translateY(0); }

    .affirmation{
      margin: 14px 0 12px;
      padding: 18px 16px;
      border-radius: 20px;
      border: 1px dashed rgba(255, 79, 161, .40);
      background: rgba(255, 255, 255, .62);
      position:relative;
      overflow:hidden;
    }

    .quote{
      font-size: clamp(18px, 2.4vw, 26px);
      line-height: 1.25;
      font-weight: 800;
      letter-spacing: .2px;
    }

    .quote.animate{
      animation: shimmer .6s ease;
    }

    @keyframes shimmer{
      0%{ transform: translateY(8px); opacity: 0; filter: blur(1px); }
      100%{ transform: translateY(0); opacity: 1; filter: blur(0); }
    }

    .meta{
      margin-top: 10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      color: var(--muted);
      font-weight:700;
      font-size: 13px;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 12px;
    }

    .btn{
      cursor:pointer;
      border:none;
      border-radius: 16px;
      padding: 12px 14px;
      font-weight: 800;
      letter-spacing:.2px;
      color: #fff;
      background: linear-gradient(135deg, var(--hot), var(--hot2));
      box-shadow: 0 14px 30px rgba(255, 79, 161, .22);
      transition: transform .16s ease, box-shadow .16s ease, filter .2s ease;
      display:inline-flex;
      align-items:center;
      gap:10px;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-2px) scale(1.01); box-shadow: 0 18px 40px rgba(255, 79, 161, .28); }
    .btn:active{ transform: translateY(0); }

    .btn.secondary{
      color: var(--ink);
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(255, 179, 214, .9);
      box-shadow: 0 10px 22px rgba(74, 42, 58, .10);
    }

    .btn.ghost{
      color: var(--hot);
      background: rgba(255,255,255,.25);
      border: 1px solid rgba(255, 79, 161, .35);
      box-shadow: none;
    }

    .side{
      display:flex;
      flex-direction:column;
      gap: 18px;
    }

    .panelTitle{
      font-weight:900;
      color:#ff2f97;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin: 0 0 10px;
    }

    .list{
      list-style:none;
      margin:0;
      padding:0;
      display:flex;
      flex-direction:column;
      gap:10px;
      max-height: 330px;
      overflow:auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,79,161,.35) transparent;
    }

    .list::-webkit-scrollbar{ width:10px; }
    .list::-webkit-scrollbar-thumb{
      background: rgba(255,79,161,.35);
      border-radius: 999px;
      border: 3px solid transparent;
      background-clip: content-box;
    }

    .item{
      background: rgba(255,255,255,.70);
      border: 1px solid rgba(255, 179, 214, .75);
      border-radius: 18px;
      padding: 10px 10px 10px 12px;
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
      transition: transform .14s ease;
    }
    .item:hover{ transform: translateY(-1px); }

    .item p{
      margin:0;
      font-weight: 800;
      line-height: 1.25;
      color: var(--ink);
      font-size: 14px;
    }
    .item small{
      display:block;
      margin-top:4px;
      color: var(--muted);
      font-weight:700;
      opacity:.9;
    }

    .itemBtns{
      display:flex;
      gap:8px;
      flex: 0 0 auto;
      margin-left:8px;
    }

    .mini{
      cursor:pointer;
      border:none;
      border-radius: 14px;
      padding: 8px 10px;
      font-weight: 900;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(255, 179, 214, .9);
      color: var(--muted);
      transition: transform .15s ease, background .2s ease;
      user-select:none;
    }
    .mini:hover{ transform: translateY(-1px); background: rgba(255,255,255,.9); }
    .mini:active{ transform: translateY(0); }

    .footerNote{
      text-align:center;
      color: var(--muted);
      font-weight:700;
      font-size: 12px;
      opacity:.95;
      margin-top: 8px;
    }

    /* Floating background hearts */
    .floatLayer{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:0;
    }

    .float{
      position:absolute;
      bottom:-60px;
      left: var(--x, 50%);
      font-size: var(--s, 18px);
      opacity: var(--o, .35);
      filter: blur(var(--b, 0px));
      transform: translateY(0) rotate(var(--r, 0deg));
      animation: rise var(--d, 10s) linear infinite;
    }

    @keyframes rise{
      0%{ transform: translateY(0) translateX(0) rotate(var(--r)); opacity: 0; }
      10%{ opacity: var(--o); }
      100%{ transform: translateY(-120vh) translateX(var(--drift, 60px)) rotate(calc(var(--r) + 120deg)); opacity: 0; }
    }

    /* Confetti */
    .confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index: 50;
      overflow:hidden;
    }
    .conf{
      position:absolute;
      top:-20px;
      left: var(--x);
      width: 10px;
      height: 18px;
      background: var(--c);
      opacity:.9;
      border-radius: 3px;
      transform: rotate(var(--rot));
      animation: fall var(--t) ease-in forwards;
      filter: drop-shadow(0 6px 10px rgba(255,79,161,.20));
    }
    @keyframes fall{
      to{
        top: 110vh;
        transform: translateX(var(--dx)) rotate(calc(var(--rot) + 360deg));
        opacity: 0;
      }
    }

    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    .app, header{ position:relative; z-index:2; }
  </style>
</head>
<body>
  <div class="floatLayer" id="floatLayer" aria-hidden="true"></div>
  <div class="confetti" id="confetti" aria-hidden="true"></div>

  <div class="wrap">
    <div style="width:min(980px, 100%);">
      <header>
        <div class="logo">Daily Affirmations</div>
        <p class="subtitle">a tiny pink moment for your mind ‚ú®</p>
      </header>

      <main class="app">
        <section class="card" aria-live="polite">
          <div class="nowRow">
            <div class="pill"><span class="dot"></span><span id="todayLabel">Today</span></div>
            <div class="toggles">
              <button class="toggle" id="soundBtn" type="button" aria-pressed="true">üîä Sound</button>
              <button class="toggle" id="motionBtn" type="button" aria-pressed="true">üí´ Motion</button>
            </div>
          </div>

          <div class="affirmation">
            <div class="quote" id="quote">Loading your sparkle‚Ä¶</div>
            <div class="meta">
              <span id="tag">pink era</span>
              <span id="counter">‚Äî</span>
            </div>
          </div>

          <div class="actions">
            <button class="btn" id="newBtn" type="button">üéÄ New affirmation</button>
            <button class="btn secondary" id="favBtn" type="button">üíó Save to favorites</button>
            <button class="btn ghost" id="copyBtn" type="button">üìã Copy</button>
          </div>

          <p class="footerNote">Tip: Your ‚Äúdaily‚Äù one is the first you see each day. Favorites stay on this device.</p>
        </section>

        <aside class="side">
          <section class="card">
            <div class="panelTitle">
              <span>üíñ Favorites</span>
              <button class="mini" id="clearFavs" type="button" title="Clear favorites">üßπ</button>
            </div>
            <ul class="list" id="favoritesList"></ul>
            <p class="footerNote" id="favEmpty">No favorites yet ‚Äî save one you love üíï</p>
          </section>

          <section class="card">
            <div class="panelTitle">
              <span>ü´ß Recent</span>
              <button class="mini" id="clearHistory" type="button" title="Clear recent">üßπ</button>
            </div>
            <ul class="list" id="historyList"></ul>
            <p class="footerNote" id="histEmpty">Your recent affirmations show up here ‚ú®</p>
          </section>
        </aside>
      </main>
    </div>
  </div>

  <script>
    // -----------------------------
    // Cute Pink Daily Affirmations
    // Single-file, no libraries
    // -----------------------------

    const AFFIRMATIONS = [
      "I am allowed to take up space and be seen.",
      "I choose softness with myself today.",
      "My pace is perfect for me.",
      "I trust my timing and my tiny steps.",
      "I can do hard things gently.",
      "I release what I can‚Äôt control and keep what I can.",
      "I am becoming someone I‚Äôm proud of.",
      "My feelings are valid and they will move through me.",
      "I deserve love that feels calm and true.",
      "I am not behind. I am on my path.",
      "Today, I will speak to myself like someone I adore.",
      "I attract peace, clarity, and sweet surprises.",
      "I am safe to rest and still be worthy.",
      "My energy is precious. I spend it with care.",
      "I glow differently when I‚Äôm kind to myself.",
      "I welcome joy in small, sparkly ways.",
      "I can start again as many times as I need.",
      "I honor my needs without apologizing.",
      "I am learning, growing, and blooming.",
      "I am worthy of good things, right now.",
      "I choose thoughts that support me.",
      "I‚Äôm allowed to be a work in progress and still be magical.",
      "I create space for the life I want.",
      "I trust myself to figure it out.",
      "I am more than my doubts.",
      "I am loved, even as I evolve.",
      "I bring softness and strength everywhere I go.",
      "My voice matters. My boundaries matter.",
      "I can be both ambitious and gentle.",
      "I let today be enough."
    ];

    const TAGS = ["pink era", "soft power", "main character", "gentle glow", "sweet clarity", "calm confidence", "tiny wins"];

    // --- DOM
    const quoteEl = document.getElementById("quote");
    const tagEl = document.getElementById("tag");
    const counterEl = document.getElementById("counter");
    const todayLabelEl = document.getElementById("todayLabel");

    const newBtn = document.getElementById("newBtn");
    const favBtn = document.getElementById("favBtn");
    const copyBtn = document.getElementById("copyBtn");

    const favoritesList = document.getElementById("favoritesList");
    const historyList = document.getElementById("historyList");
    const favEmpty = document.getElementById("favEmpty");
    const histEmpty = document.getElementById("histEmpty");

    const clearFavs = document.getElementById("clearFavs");
    const clearHistory = document.getElementById("clearHistory");

    const floatLayer = document.getElementById("floatLayer");
    const confettiLayer = document.getElementById("confetti");

    const soundBtn = document.getElementById("soundBtn");
    const motionBtn = document.getElementById("motionBtn");

    // --- State
    let current = "";
    let soundOn = true;
    let motionOn = true;
    let sessionCount = 0;

    const STORAGE_KEYS = {
      favs: "pink_affirmations_favs_v1",
      hist: "pink_affirmations_hist_v1",
      settings: "pink_affirmations_settings_v1"
    };

    // --- Utilities
    function formatDate(d){
      const opts = { weekday:"long", year:"numeric", month:"long", day:"numeric" };
      return d.toLocaleDateString(undefined, opts);
    }

    // Simple seeded RNG (Mulberry32)
    function mulberry32(seed){
      return function(){
        let t = seed += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      }
    }

    function seedFromDate(d){
      // yyyymmdd
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return Number(`${y}${m}${day}`);
    }

    function pick(arr, randFn){
      return arr[Math.floor(randFn() * arr.length)];
    }

    function hapticLike(){
      // playful micro-wiggle
      quoteEl.classList.remove("animate");
      void quoteEl.offsetWidth;
      quoteEl.classList.add("animate");
    }

    function setQuote(text, {pushHistory=true} = {}){
      current = text;
      quoteEl.textContent = text;
      hapticLike();
      sessionCount++;
      counterEl.textContent = `‚ú® ${sessionCount} today`;

      // tag
      const tagRand = mulberry32((Date.now() >>> 0) ^ (text.length * 1337));
      tagEl.textContent = pick(TAGS, tagRand);

      if (pushHistory) addToHistory(text);
      if (soundOn) blip();
    }

    function dedupe(arr){
      return [...new Set(arr)];
    }

    function loadJSON(key, fallback){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return fallback;
        return JSON.parse(raw);
      }catch{
        return fallback;
      }
    }

    function saveJSON(key, value){
      try{ localStorage.setItem(key, JSON.stringify(value)); }catch{}
    }

    // --- Sound (tiny synth blip via WebAudio)
    let audioCtx;
    function blip(){
      try{
        audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = "sine";
        o.frequency.value = 740 + Math.random()*160;
        g.gain.value = 0.0001;

        o.connect(g);
        g.connect(audioCtx.destination);

        const t = audioCtx.currentTime;
        g.gain.setValueAtTime(0.0001, t);
        g.gain.exponentialRampToValueAtTime(0.08, t + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, t + 0.12);

        o.start(t);
        o.stop(t + 0.14);
      }catch{
        // ignore
      }
    }

    // --- Confetti burst
    function confettiBurst(){
      if (!motionOn) return;
      const colors = ["#ff4fa1","#ff7bc0","#ffd1e6","#f7b0ff","#ffffff","#ffb3d6"];
      const n = 26;
      for(let i=0;i<n;i++){
        const el = document.createElement("div");
        el.className = "conf";
        const x = (Math.random() * 100).toFixed(2) + "vw";
        const c = colors[Math.floor(Math.random()*colors.length)];
        const rot = (Math.random()*180-90).toFixed(1) + "deg";
        const dx = (Math.random()*240-120).toFixed(1) + "px";
        const t = (0.9 + Math.random()*0.9).toFixed(2) + "s";
        el.style.setProperty("--x", x);
        el.style.setProperty("--c", c);
        el.style.setProperty("--rot", rot);
        el.style.setProperty("--dx", dx);
        el.style.setProperty("--t", t);
        confettiLayer.appendChild(el);
        setTimeout(()=> el.remove(), 2200);
      }
    }

    // --- Floating hearts & sparkles
    const FLOAT_EMOJIS = ["üíó","‚ú®","üíñ","ü´ß","üéÄ","üå∏","üíû","‚≠ê","ü©∑"];
    function spawnFloaties(){
      floatLayer.innerHTML = "";
      if(!motionOn) return;

      const count = Math.min(22, Math.max(14, Math.floor(window.innerWidth / 60)));
      for(let i=0;i<count;i++){
        const el = document.createElement("div");
        el.className = "float";
        el.textContent = FLOAT_EMOJIS[Math.floor(Math.random()*FLOAT_EMOJIS.length)];
        const x = (Math.random()*100).toFixed(2) + "vw";
        const s = (14 + Math.random()*20).toFixed(1) + "px";
        const o = (0.18 + Math.random()*0.28).toFixed(2);
        const b = (Math.random() < 0.25 ? (0.6 + Math.random()*0.8).toFixed(1) : "0") + "px";
        const r = (Math.random()*90-45).toFixed(1) + "deg";
        const d = (10 + Math.random()*10).toFixed(2) + "s";
        const drift = (Math.random()*160-80).toFixed(1) + "px";

        el.style.setProperty("--x", x);
        el.style.setProperty("--s", s);
        el.style.setProperty("--o", o);
        el.style.setProperty("--b", b);
        el.style.setProperty("--r", r);
        el.style.setProperty("--d", d);
        el.style.setProperty("--drift", drift);

        // stagger start so it feels alive
        el.style.animationDelay = (-Math.random()*10).toFixed(2) + "s";
        floatLayer.appendChild(el);
      }
    }

    // --- Favorites & history
    function render(){
      const favs = loadJSON(STORAGE_KEYS.favs, []);
      const hist = loadJSON(STORAGE_KEYS.hist, []);

      favoritesList.innerHTML = "";
      historyList.innerHTML = "";

      favEmpty.style.display = favs.length ? "none" : "block";
      histEmpty.style.display = hist.length ? "none" : "block";

      favs.slice().reverse().forEach((text, idx) => {
        favoritesList.appendChild(makeItem(text, {
          kind:"fav",
          onUse: ()=> setQuote(text, {pushHistory:true}),
          onRemove: ()=> removeFavorite(text)
        }));
      });

      hist.slice().reverse().forEach((entry) => {
        historyList.appendChild(makeItem(entry.text, {
          kind:"hist",
          meta: entry.when,
          onUse: ()=> setQuote(entry.text, {pushHistory:false}),
          onRemove: ()=> removeHistory(entry)
        }));
      });
    }

    function makeItem(text, {kind, meta, onUse, onRemove}){
      const li = document.createElement("li");
      li.className = "item";

      const left = document.createElement("div");
      const p = document.createElement("p");
      p.textContent = text;

      const small = document.createElement("small");
      small.textContent = meta || (kind === "fav" ? "favorite" : "");

      left.appendChild(p);
      left.appendChild(small);

      const btns = document.createElement("div");
      btns.className = "itemBtns";

      const use = document.createElement("button");
      use.className = "mini";
      use.type = "button";
      use.textContent = "‚ú®";
      use.title = "Use this";
      use.addEventListener("click", onUse);

      const del = document.createElement("button");
      del.className = "mini";
      del.type = "button";
      del.textContent = "üóëÔ∏è";
      del.title = "Remove";
      del.addEventListener("click", onRemove);

      btns.appendChild(use);
      btns.appendChild(del);

      li.appendChild(left);
      li.appendChild(btns);
      return li;
    }

    function addToFavorites(text){
      const favs = loadJSON(STORAGE_KEYS.favs, []);
      if (favs.includes(text)) return false;
      favs.push(text);
      saveJSON(STORAGE_KEYS.favs, favs);
      return true;
    }

    function removeFavorite(text){
      const favs = loadJSON(STORAGE_KEYS.favs, []).filter(x => x !== text);
      saveJSON(STORAGE_KEYS.favs, favs);
      render();
    }

    function addToHistory(text){
      const hist = loadJSON(STORAGE_KEYS.hist, []);
      const when = new Date().toLocaleTimeString(undefined, {hour:"2-digit", minute:"2-digit"});
      hist.push({ text, when });
      // keep it tidy
      const trimmed = hist.slice(-18);
      saveJSON(STORAGE_KEYS.hist, trimmed);
      render();
    }

    function removeHistory(entry){
      const hist = loadJSON(STORAGE_KEYS.hist, []).filter(e => !(e.text === entry.text && e.when === entry.when));
      saveJSON(STORAGE_KEYS.hist, hist);
      render();
    }

    // --- Daily selection
    function dailyAffirmation(){
      const today = new Date();
      const seed = seedFromDate(today);
      const rand = mulberry32(seed);
      return pick(AFFIRMATIONS, rand);
    }

    function randomAffirmation(){
      const rand = mulberry32((Date.now() >>> 0) ^ (Math.random()*1e9|0));
      return pick(AFFIRMATIONS, rand);
    }

    // --- Clipboard
    async function copyCurrent(){
      try{
        await navigator.clipboard.writeText(current);
        toast("Copied üíû");
        if (soundOn) blip();
      }catch{
        // fallback
        const ta = document.createElement("textarea");
        ta.value = current;
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand("copy"); toast("Copied üíû"); } catch { toast("Copy blocked üòø"); }
        ta.remove();
      }
    }

    // --- Tiny toast
    let toastTimer;
    function toast(msg){
      clearTimeout(toastTimer);
      let t = document.getElementById("toast");
      if(!t){
        t = document.createElement("div");
        t.id = "toast";
        t.style.position = "fixed";
        t.style.left = "50%";
        t.style.bottom = "22px";
        t.style.transform = "translateX(-50%)";
        t.style.padding = "10px 14px";
        t.style.borderRadius = "999px";
        t.style.background = "rgba(255,255,255,.82)";
        t.style.border = "1px solid rgba(255,179,214,.95)";
        t.style.boxShadow = "0 14px 30px rgba(255,79,161,.20)";
        t.style.color = "rgba(74,42,58,.92)";
        t.style.fontWeight = "900";
        t.style.zIndex = "99";
        t.style.backdropFilter = "blur(10px)";
        t.style.opacity = "0";
        t.style.transition = "opacity .2s ease, transform .2s ease";
        document.body.appendChild(t);
      }
      t.textContent = msg;
      requestAnimationFrame(()=>{
        t.style.opacity = "1";
        t.style.transform = "translateX(-50%) translateY(-2px)";
      });
      toastTimer = setTimeout(()=>{
        t.style.opacity = "0";
        t.style.transform = "translateX(-50%) translateY(0)";
      }, 1200);
    }

    // --- Settings
    function loadSettings(){
      const s = loadJSON(STORAGE_KEYS.settings, {soundOn:true, motionOn:true});
      soundOn = !!s.soundOn;
      motionOn = !!s.motionOn;
      soundBtn.setAttribute("aria-pressed", String(soundOn));
      motionBtn.setAttribute("aria-pressed", String(motionOn));
      soundBtn.textContent = soundOn ? "üîä Sound" : "üîá Sound";
      motionBtn.textContent = motionOn ? "üí´ Motion" : "ü´ß Motion";
      if (!motionOn){
        floatLayer.innerHTML = "";
        confettiLayer.innerHTML = "";
      } else {
        spawnFloaties();
      }
    }

    function saveSettings(){
      saveJSON(STORAGE_KEYS.settings, {soundOn, motionOn});
    }

    // --- Wire up
    newBtn.addEventListener("click", () => {
      setQuote(randomAffirmation(), {pushHistory:true});
      confettiBurst();
    });

    favBtn.addEventListener("click", () => {
      if(!current) return;
      const added = addToFavorites(current);
      render();
      if(added){
        toast("Saved üíó");
        confettiBurst();
        if (soundOn) blip();
      } else {
        toast("Already in favorites ‚ú®");
      }
    });

    copyBtn.addEventListener("click", copyCurrent);

    clearFavs.addEventListener("click", () => {
      saveJSON(STORAGE_KEYS.favs, []);
      render();
      toast("Favorites cleared üßπ");
    });

    clearHistory.addEventListener("click", () => {
      saveJSON(STORAGE_KEYS.hist, []);
      render();
      toast("Recent cleared üßπ");
    });

    soundBtn.addEventListener("click", () => {
      soundOn = !soundOn;
      soundBtn.setAttribute("aria-pressed", String(soundOn));
      soundBtn.textContent = soundOn ? "üîä Sound" : "üîá Sound";
      saveSettings();
      toast(soundOn ? "Sound on ‚ú®" : "Sound off ü´ß");
      if(soundOn) blip();
    });

    motionBtn.addEventListener("click", () => {
      motionOn = !motionOn;
      motionBtn.setAttribute("aria-pressed", String(motionOn));
      motionBtn.textContent = motionOn ? "üí´ Motion" : "ü´ß Motion";
      saveSettings();
      toast(motionOn ? "Motion on üíû" : "Motion off üåô");
      spawnFloaties();
    });

    window.addEventListener("resize", () => spawnFloaties());

    // --- Init
    (function init(){
      loadSettings();
      const today = new Date();
      todayLabelEl.textContent = formatDate(today);

      // Show daily first (no history push), then start counting.
      sessionCount = 0;
      setQuote(dailyAffirmation(), {pushHistory:false});
      counterEl.textContent = "‚ú® your daily";
      render();
      spawnFloaties();
    })();
  </script>
</body>
</html>